<div class="container py-4" style="min-height: 100vh;">

  <!-- Loading State -->
  <div *ngIf="isLoadingUserData" class="text-center py-5">
    <app-loader-material></app-loader-material>
    <p class="text-muted mt-3">Loading settings...</p>
  </div>

  <!-- Settings Content -->
  <div *ngIf="!isLoadingUserData">
    
    <!-- HEADER -->
    <div class="row mb-4">
      <div class="col-12 d-flex justify-content-between align-items-center">
        <div>
          <h3 class="fw-bold">Settings</h3>
          <p class="text-muted">Manage your account security and notifications</p>
        </div>
      </div>
    </div>

    <!-- PILLS -->
    <ul class="nav nav-pills mb-4">
      <li class="nav-item">
        <a class="nav-link" 
           [class.active]="activeTab==='security'" 
           (click)="toggleTab('security')">
          <i class="fa fa-shield-alt me-2"></i>Security
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link" 
           [class.active]="activeTab==='notifications'" 
           (click)="toggleTab('notifications')">
          <i class="fa fa-bell me-2"></i>Notifications
        </a>
      </li>
    </ul>

    <!-- SECURITY TAB -->
    <div *ngIf="activeTab === 'security'" class="row g-4">
      
      <!-- Change Password Card -->
      <div class="col-md-6">
        <div class="card p-4 shadow-sm h-100">
          <div class="d-flex align-items-center mb-3">
            <i class="fa fa-key fs-4 text-primary me-3"></i>
            <div>
              <h5 class="card-title mb-1">Change Password</h5>
              <p class="text-muted small mb-0">Update your account password regularly</p>
            </div>
          </div>

          <!-- Current Password -->
          <div class="mb-3">
            <label class="form-label fw-semibold">
              Current Password <span class="text-danger">*</span>
            </label>
            <div class="input-group">
              <input 
                [type]="showCurrent ? 'text' : 'password'" 
                class="form-control" 
                [(ngModel)]="currentPassword"
                placeholder="Enter current password"
                [disabled]="isChangingPassword">
              <span class="input-group-text password-toggle" (click)="togglePassword('current')">
                <i [class.fa-eye]="!showCurrent" [class.fa-eye-slash]="showCurrent" class="fas"></i>
              </span>
            </div>
          </div>

          <!-- New Password -->
          <div class="mb-3">
            <label class="form-label fw-semibold">
              New Password <span class="text-danger">*</span>
            </label>
            <div class="input-group">
              <input 
                [type]="showNew ? 'text' : 'password'" 
                class="form-control" 
                [(ngModel)]="newPassword"
                placeholder="Enter new password"
                [disabled]="isChangingPassword">
              <span class="input-group-text password-toggle" (click)="togglePassword('new')">
                <i [class.fa-eye]="!showNew" [class.fa-eye-slash]="showNew" class="fas"></i>
              </span>
            </div>
            
            <!-- Password Strength Indicator -->
            <div *ngIf="newPassword" class="mt-2">
              <div class="password-strength-bar">
                <div class="password-strength-fill" 
                     [style.width]="getPasswordStrength(newPassword).width"
                     [style.background-color]="getPasswordStrength(newPassword).color">
                </div>
              </div>
              <small class="text-muted">
                Strength: <span [style.color]="getPasswordStrength(newPassword).color" class="fw-semibold">
                  {{ getPasswordStrength(newPassword).text }}
                </span>
              </small>
            </div>
          </div>

          <!-- Confirm Password -->
          <div class="mb-3">
            <label class="form-label fw-semibold">
              Confirm Password <span class="text-danger">*</span>
            </label>
            <div class="input-group">
              <input 
                [type]="showConfirm ? 'text' : 'password'" 
                class="form-control" 
                [(ngModel)]="confirmPassword"
                placeholder="Re-enter new password"
                [class.is-invalid]="confirmPassword && newPassword !== confirmPassword"
                [disabled]="isChangingPassword">
              <span class="input-group-text password-toggle" (click)="togglePassword('confirm')">
                <i [class.fa-eye]="!showConfirm" [class.fa-eye-slash]="showConfirm" class="fas"></i>
              </span>
            </div>
            <small *ngIf="confirmPassword && newPassword !== confirmPassword" class="text-danger">
              <i class="fa fa-exclamation-circle me-1"></i>Passwords do not match
            </small>
          </div>

          <!-- Password Requirements -->
          <div class="password-requirements mb-3">
            <small class="text-muted d-block mb-1">Password must contain:</small>
            <small class="text-muted d-block">
              <i class="fa fa-check-circle me-1" 
                 [class.text-success]="newPassword.length >= 6"
                 [class.text-muted]="newPassword.length < 6"></i>
              At least 6 characters
            </small>
          </div>

          <button 
            class="btn btn-primary w-100" 
            (click)="changePassword()"
            [disabled]="isChangingPassword">
            <app-loader-material *ngIf="isChangingPassword"></app-loader-material>
            <i *ngIf="!isChangingPassword" class="fa fa-lock me-2"></i>
            <span>{{ isChangingPassword ? 'Updating...' : 'Update Password' }}</span>
          </button>
        </div>
      </div>

      <!-- Two-Factor Authentication Card -->
      <div class="col-md-6">
        <div class="card p-4 shadow-sm h-100">
          <div class="d-flex align-items-center mb-3">
            <i class="fa fa-mobile-alt fs-4 text-primary me-3"></i>
            <div>
              <h5 class="card-title mb-1">Two-Factor Authentication</h5>
              <p class="text-muted small mb-0">Extra security for your account</p>
            </div>
          </div>

          <p class="text-muted mb-3">
            Enable two-factor authentication for an additional layer of security when logging in. 
            You'll need to enter a verification code sent to your email or phone.
          </p>

          <!-- MFA Status -->
          <div class="mfa-status mb-4">
            <div class="d-flex align-items-center p-3 rounded" 
                 [class.bg-success-subtle]="isMfaEnabled"
                 [class.bg-warning-subtle]="!isMfaEnabled">
              <i class="fa fa-2x me-3"
                 [class.fa-check-circle]="isMfaEnabled"
                 [class.fa-exclamation-triangle]="!isMfaEnabled"
                 [class.text-success]="isMfaEnabled"
                 [class.text-warning]="!isMfaEnabled"></i>
              <div>
                <strong class="d-block">
                  {{ isMfaEnabled ? '2FA Enabled' : '2FA Disabled' }}
                </strong>
                <small class="text-muted">
                  {{ isMfaEnabled 
                     ? 'Your account is protected with two-factor authentication' 
                     : 'Your account is not protected with two-factor authentication' }}
                </small>
              </div>
            </div>
          </div>

          <!-- MFA Benefits -->
          <div class="mfa-benefits mb-4">
            <h6 class="fw-semibold mb-2">Benefits of 2FA:</h6>
            <ul class="list-unstyled">
              <li class="mb-2">
                <i class="fa fa-check text-success me-2"></i>
                <small>Enhanced account security</small>
              </li>
              <li class="mb-2">
                <i class="fa fa-check text-success me-2"></i>
                <small>Protection against unauthorized access</small>
              </li>
              <li class="mb-2">
                <i class="fa fa-check text-success me-2"></i>
                <small>Peace of mind for sensitive operations</small>
              </li>
            </ul>
          </div>

          <button 
            class="btn w-100" 
            [class.btn-danger]="isMfaEnabled"
            [class.btn-primary]="!isMfaEnabled"
            (click)="toggleMfa()"
            [disabled]="isEnablingMfa">
            <app-loader-material *ngIf="isEnablingMfa"></app-loader-material>
            <i *ngIf="!isEnablingMfa" class="fa me-2"
               [class.fa-times-circle]="isMfaEnabled"
               [class.fa-shield-alt]="!isMfaEnabled"></i>
            <span>
              {{ isEnablingMfa ? 'Processing...' : (isMfaEnabled ? 'Disable 2FA' : 'Enable 2FA') }}
            </span>
          </button>
        </div>
      </div>

    </div>

    <!-- NOTIFICATIONS TAB -->
    <div *ngIf="activeTab === 'notifications'" class="row g-4">
      <div class="col-12">
        <div class="card p-4 shadow-sm">
          <div class="d-flex align-items-center mb-4">
            <i class="fa fa-bell fs-4 text-primary me-3"></i>
            <div>
              <h5 class="card-title mb-1">Notification Preferences</h5>
              <p class="text-muted small mb-0">Choose how you want to be notified</p>
            </div>
          </div>

          <div class="notification-item">
            <div class="form-check form-switch">
              <input 
                class="form-check-input" 
                type="checkbox" 
                id="orderUpdates" 
                [(ngModel)]="notifications.orderUpdates">
              <label class="form-check-label" for="orderUpdates">
                <div class="d-flex align-items-start">
                  <i class="fa fa-box text-primary me-3 mt-1"></i>
                  <div>
                    <strong class="d-block">Order Updates</strong>
                    <small class="text-muted">Get notified about your order status changes</small>
                  </div>
                </div>
              </label>
            </div>
          </div>

          <hr>

          <div class="notification-item">
            <div class="form-check form-switch">
              <input 
                class="form-check-input" 
                type="checkbox" 
                id="promotions" 
                [(ngModel)]="notifications.promotions">
              <label class="form-check-label" for="promotions">
                <div class="d-flex align-items-start">
                  <i class="fa fa-tags text-primary me-3 mt-1"></i>
                  <div>
                    <strong class="d-block">Promotions</strong>
                    <small class="text-muted">Receive updates about special offers and discounts</small>
                  </div>
                </div>
              </label>
            </div>
          </div>

          <hr>

          <div class="notification-item">
            <div class="form-check form-switch">
              <input 
                class="form-check-input" 
                type="checkbox" 
                id="newsletter" 
                [(ngModel)]="notifications.newsletter">
              <label class="form-check-label" for="newsletter">
                <div class="d-flex align-items-start">
                  <i class="fa fa-envelope text-primary me-3 mt-1"></i>
                  <div>
                    <strong class="d-block">Newsletter</strong>
                    <small class="text-muted">Monthly updates, tips, and industry news</small>
                  </div>
                </div>
              </label>
            </div>
          </div>

          <div class="mt-4">
            <button class="btn btn-primary">
              <i class="fa fa-save me-2"></i>Save Preferences
            </button>
          </div>

        </div>
      </div>
    </div>

  </div>

</div>